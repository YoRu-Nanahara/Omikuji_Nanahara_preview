/* 1ï¸âƒ£ åœ¨ CSS æœ€ä¸Šæ–¹å…ˆè¼‰å…¥ Web Font */
@import url('https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;700&display=swap');
#loadingScreen {
  position: fixed;
  inset: 0;
  background: black;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-direction: column;
  z-index: 9999;
}

/* ===== Screen ç®¡ç†ï¼ˆçµæ§‹å±¤ï¼‰===== */
.screen {
  position: absolute;
  inset: 0;
}

.hidden {
  display: none;
}


.loading-bg {
  position: absolute;
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.loading-sakura {
  width: 120px;
  animation: spin 3.5s linear infinite;
  z-index: 2;
}

#loadingText {
  margin-top: 20px;
  color: white;
  font-size: 20px;
  letter-spacing: 2px;
  z-index: 2;
}

@keyframes spin {
  from { transform: rotate(0deg); }
  to   { transform: rotate(360deg); }
}

/* å°è¦½é  */
#introScreen {
  display: none;
  position: absolute;
  left: 50%;
  top: 50%;
  width: 1080px;   /* èˆ‡è¨­è¨ˆç¨¿å¯¬ä¸€è‡´ */
  height: 1920px;  /* èˆ‡è¨­è¨ˆç¨¿é«˜ä¸€è‡´ */
  transform: translate(-50%, -50%);
  z-index: 1000;   /* é«˜æ–¼ Loading ç•«é¢å’Œèˆå°åº•åœ– */
  opacity: 1;      /* åˆå§‹å®Œå…¨å¯è¦‹ */
  transition: opacity 1s ease; /* æ·¡å‡ºæ•ˆæœ */
}

.intro-bg {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

#introText {
  font-family: 'Open Sans', sans-serif;
  position: absolute;
  top: 10%;
  left: 50%;
  transform: translate(-50%, 0);
  text-align: center;
  color: rgb(78, 51, 55);
  font-size: 40.3px;
  line-height: 2;
  width: 100%; 
  max-width: 800px;
}

#introText div {
  opacity: 0;
  transform: translateY(20px);
}


@keyframes fadeUpLine {
  0% {
    opacity: 0;
    transform: translateY(20px);
  }
  100% {
    opacity: 1;
    transform: translateY(0);
  }
}



#menuScreen {
  position: absolute;
  inset: 0;
}


.menu-background {
  position: absolute;
  inset: 0;              /* å…¨è¢å¹• */
  width: 100%;
  height: 100%;
  background-size: cover;
  background-position: center;
  z-index: 1;
}

/* ç™½å¤©èƒŒæ™¯ */
.menu-background.day {
  background-image: url("images/menu-bg.jpg");
}

/* å¤œæ™šèƒŒæ™¯ */
.menu-background.night {
  background-image: url("images/menu-bg-night.jpg");
}

/* menu æŒ‰éˆ•å‘¼å¸å‹•ç•« */
@keyframes menuPulse {
  0% {
    transform: scale(1);
  }
  50% {
    transform: scale(1.03); /* æœ€å¤§æ”¾å¤§ 3% */
  }
  100% {
    transform: scale(1);
  }
}

#menuScreen {
  opacity: 1;            /* ä¸€é–‹å§‹å°±é¡¯ç¤º */
}

.menu-content {
  opacity: 0;                  /* åˆå§‹å®Œå…¨é€æ˜ */
  transform: translateY(20px); /* å¾€ä¸Š 20pxï¼Œè£½é€ æµ®å‹•æ„Ÿ */
  transition: opacity 1.5s ease, transform 1.5s ease;
}

.menu-content.show {
  opacity: 1;                  /* å®Œå…¨å¯è¦‹ */
  transform: translateY(0);    /* å›åˆ°åŸæœ¬ä½ç½® */
}


.menu-content {
  position: relative;     /* è®“ z-index æœ‰æ•ˆ */
  z-index: 2;             /* é«˜æ–¼èƒŒæ™¯ */
  width: 100%;
  height: 100%;           /* å¡«æ»¿æ•´å€‹ menuScreen */
  display: flex;          /* å•Ÿç”¨ Flex */
  flex-direction: column; /* ä¸Šä¸‹æ’åˆ— header + buttons */
  align-items: center;    /* æ°´å¹³ç½®ä¸­ */
  justify-content: center; /* å‚ç›´ç½®ä¸­ */
  padding-top: 40px;      /* â† åŠ é€™è¡Œè®“æ•´çµ„å¾€ä¸‹ */
}


.menu-buttons {
  display: flex;          /* è®“æŒ‰éˆ•æ°´å¹³æ’åˆ— */
  flex-direction: column; /* æ”¹æˆå‚ç›´æ’åˆ— */
  align-items: center;    /* æ°´å¹³ç½®ä¸­ */
  gap: 20px;              /* æŒ‰éˆ•é–“è· */
}

.menu-btn {
  background: transparent;
  border: none;
  padding: 0;
  cursor: pointer;
  width: 600px;           /* æŒ‰éˆ•å¯¬åº¦ */
  height: auto;
  animation: menuPulse 2s ease-in-out infinite; /* â† å‘¼å¸å‹•ç•« */
}

.menu-btn img {
  display: block;
  width: 100%;
  height: auto;
}

/* ===== Menu åº•éƒ¨æ­¡è¿æ–‡å­— ===== */
/* ===== Menu åº•éƒ¨æ­¡è¿æ–‡å­— ===== */
#menuWelcomeText {
  position: absolute;
  left: 50%;
  bottom: 120px;

  transform: translateX(-50%);
  font-family: 'Open Sans', sans-serif;
  font-size: 60px;
  letter-spacing: 3px;

  text-align: center;

  z-index: 5;
  pointer-events: none;

  opacity: 0;
  transition: opacity 1.5s ease, color 0.6s ease;
}

/* â˜€ï¸ ç™½å¤©ï¼ˆé è¨­ï¼‰ */
body:not(.night-mode) #menuWelcomeText {
  color: #ffffff;
}

/* ğŸŒ™ å¤œæ™š */
body.night-mode #menuWelcomeText {
  color: rgba(255, 245, 235, 0.9);
}


/* âœ… åªè¦ menuScreen é¡¯ç¤ºï¼Œå°±è®“å®ƒå‡ºç¾ */
#menuScreen:not(.hidden) #menuWelcomeText {
  opacity: 1;
  text-shadow:
    0 0 8px rgba(255, 210, 210, 0.6),
    0 0 18px rgba(255, 220, 180, 0.4);
}

@keyframes welcomeFloat {
  0%, 100% { transform: translateX(-50%) translateY(0); }
  50%      { transform: translateX(-50%) translateY(-6px); }
}

#menuWelcomeText {
  animation: welcomeFloat 4s ease-in-out infinite;
}






#transitionDoors {
  position: absolute;
  inset: 0;
  pointer-events: none;
  z-index: 5000;
}

.door {
  position: absolute;
  top: 0;
  width: 50%;
  height: 100%;
  object-fit: cover; /* æˆ– containï¼Œçœ‹ä½ é–€åœ–æƒ³æ€éº¼å¡æ»¿ */
}

.door.left  { left: 0;  transform: translateX(-100%); }
.door.right { right: 0; transform: translateX(100%); }

.door.show.left  { animation: doorLeftIn 0.5s forwards; }
.door.show.right { animation: doorRightIn 0.5s forwards; }
.door.hide.left  { animation: doorLeftOut 0.7s forwards; }
.door.hide.right { animation: doorRightOut 0.7s forwards; }

/* âœ… é–€å®Œå…¨é—”ä¸Šå¾Œå›ºå®šåœ¨ä¸­é–“ï¼Œä¸æœƒå› ç‚ºç§»é™¤ show è€Œè·³å›ç•«é¢å¤– */
.door.closed.left  { transform: translateX(0); }
.door.closed.right { transform: translateX(0); }

@keyframes doorLeftIn {
  from { transform: translateX(-100%); }
  to   { transform: translateX(0); }
}
@keyframes doorRightIn {
  from { transform: translateX(100%); }
  to   { transform: translateX(0); }
}

@keyframes doorLeftOut {
  from { transform: translateX(0); }
  to   { transform: translateX(-100%); }
}
@keyframes doorRightOut {
  from { transform: translateX(0); }
  to   { transform: translateX(100%); }
}




html, body {
  margin: 0;
  padding: 0;
  width: 100%;
  height: 100%;
  background: black;
  overflow: hidden;
}

/* âœ… viewportï¼šè² è²¬ç½®ä¸­ï¼Œé»‘é‚Šè‡ªç„¶å‡ºç¾ */
#viewport {
  position: fixed;
  inset: 0;
  background: black;
  overflow: hidden; /* ä¿è­‰è¶…å‡ºåªæœƒè¢«è£æ‰ï¼Œé»‘é‚Šè‡ªç„¶ç•™ä¸‹ */
}


/* âœ… gameRootï¼šå›ºå®šè¨­è¨ˆç¨¿å¤§å°ï¼Œåªåš scaleï¼Œä¸åš translate ç½®ä¸­ */
#gameRoot {
  position: absolute;
  left: 50%;
  top: 50%;
  width: 1080px;
  height: 1920px;

  /* âš ï¸ ç½®ä¸­ + ç¸®æ”¾ç”±åŒä¸€å€‹ transform å®Œæˆ */
  transform: translate(-50%, -50%) scale(var(--scale, 1));
  transform-origin: center center;

  background: black;
  overflow: hidden;
}


/* screen éƒ½å¡«æ»¿èˆå° */
.screen {
  position: absolute;
  inset: 0;
}

.hidden { display: none; }

#sakura {
  position: absolute;
  inset: 0;
  width: 1080px;
  height: 1920px;
  pointer-events: none;
  z-index: 1200;
}





/* åŒ…è£å±¤æ§åˆ¶é£›èµ°å‹•ç•«ï¼Œåˆå§‹éš±è— */
#blessingWrapper {
  position: absolute;
  left: 86%;
  bottom: 220px;
  transform: translateX(-50%) translateY(0);
  z-index: 1300;
  opacity: 0; /* åˆå§‹éš±è— */
  pointer-events: none;
}

/* å¡ç‰‡æµ®å‹• + å…‰æšˆ */
#blessingCard {
  width: 800px;
}

/* é£›èµ°å‹•ç•«å¥—åœ¨ wrapper ä¸Š */
@keyframes cardFlyAway {
  0% {
    transform: translateX(-100%) translateY(0) scale(1);
    opacity: 1;
  }
  60% {
    transform: translateX(-100%) translateY(-600px) scale(1.05);
    opacity: 1;
  }
  100% {
    transform: translateX(100%) translateY(-1000px) scale(0.9);
    opacity: 0;
  }
}

.card-hide {
  animation: cardFlyAway 1.2s cubic-bezier(0.22, 1, 0.36, 1) forwards;
}

/* æµ®å‹• + å…‰æšˆå‹•ç•« */
@keyframes cardFloat {
  0%   { transform: translateX(-50%) translateY(0px); }
  50%  { transform: translateX(-50%) translateY(-18px); }
  100% { transform: translateX(-50%) translateY(0px); }
}

@keyframes cardGlow {
  0%   { filter: drop-shadow(0 0 8px rgba(255,180,200,0.4)); }
  50%  { filter: drop-shadow(0 0 22px rgba(255,200,220,0.9)); }
  100% { filter: drop-shadow(0 0 8px rgba(255,180,200,0.4)); }
}

/* å‹•ç•«å•Ÿç”¨ class */
.card-animate {
  animation: cardFloat 3.5s ease-in-out infinite, cardGlow 2.8s ease-in-out infinite;
}


/* å¾¡å®ˆè£½ä½œèƒŒæ™¯ */
#omamoriScreen .omamori-bg {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;  /* 1080Ã—1920 å°ä¸Šèˆå°æœƒå‰›å¥½ï¼Œä¸æœƒè®Šå½¢ */
  z-index: 0;
  pointer-events: none;
  display: block;
}

/* ====== Omamori æ’ç‰ˆéª¨æ¶ ====== */

/* omamoriScreen èƒŒæ™¯ä½ å·²æœ‰ï¼š#omamoriScreen .omamori-bg {...} */

/* æ‰€æœ‰å¾¡å®ˆç‰©ä»¶çš„å®¹å™¨ï¼ˆè·Ÿèˆå°åŒå¤§å°ï¼‰ */
#omamoriStage {
  position: absolute;
  inset: 0;
}

/*
  âœ… åªè¦èª¿é€™è£¡ï¼Œå°±èƒ½è®“ã€Œæ•´å€‹å¾¡å®ˆ+æŒ‰éˆ•+å®Œæˆã€ä¸Šä¸‹ç§»å‹•
  - å¾€ä¸Šï¼šæ•¸å­—è®Šå°ï¼ˆä¾‹å¦‚ 320ï¼‰
  - å¾€ä¸‹ï¼šæ•¸å­—è®Šå¤§ï¼ˆä¾‹å¦‚ 420ï¼‰
*/
:root {
  --omamori-y: 200px;
}

/* å…±ç”¨ï¼šå¾¡å®ˆä¸‰å€‹éƒ¨ä»¶ */
.omamori-part {
  position: absolute;
  width: 600px;
  left: 240px;         /* 540(èˆå°ä¸­å¿ƒ) - 300 = 240 */
  display: block;
  pointer-events: none;
}

/* ä¸ŠåŠéƒ¨ / ä¸‹åŠéƒ¨è²¼åˆ */
.omamori-part.top {
  top: var(--omamori-y);
  height: 453px;
  z-index: 10;
}

.omamori-part.bottom {
  top: calc(var(--omamori-y) + 453px);
  height: 342px;
  z-index: 10;
}

/* è´è¶çµï¼šè“‹åœ¨ä¸Šå±¤ã€åä¸­ä¸Š */
.omamori-part.knot {
  top: calc(var(--omamori-y) + 10px);
  height: 197px;
  z-index: 20;
}

/* å·¦å³æŒ‰éˆ•ï¼ˆ200x90ï¼‰ */
.omamori-arrow {
  position: absolute;
  width: 200px;
  height: 90px;
  padding: 0;
  border: none;
  background: transparent;
  cursor: pointer;
  z-index: 30;
}

.omamori-arrow img {
  width: 100%;
  height: 100%;
  display: block;
}

/* X ä½ç½®ï¼šå¾¡å®ˆå·¦å³å„ç•™ 40px */
.omamori-arrow.left  { left: 30px; }
.omamori-arrow.right { left: 850px; } 

/*
  ä¸‰æ’æŒ‰éˆ• Y ä½ç½®ï¼šå°é½Šå„éƒ¨ä»¶çš„è¦–è¦ºä¸­å¿ƒ

*/
.omamori-arrow.row-knot {
  top: calc(var(--omamori-y) + 60px);
}

.omamori-arrow.row-top {
  top: calc(var(--omamori-y) + 330px);
}

.omamori-arrow.row-bottom {
  top: calc(var(--omamori-y) + 590px);
}

/* å®ŒæˆæŒ‰éˆ•ï¼ˆ600x295ï¼‰ï¼šå¾¡å®ˆä¸‹æ–¹ç•™ä¸€æ®µè·é›¢ */
.omamori-finish {
  position: absolute;
  width: 600px;
  height: 295px;
  left: 240px;
  top: calc(var(--omamori-y) + 760px + 70px); 
  padding: 0;
  border: none;
  background: transparent;
  cursor: pointer;
  z-index: 30;
}

.omamori-finish img {
  width: 90%;
  height: 90%;
  display: block;
}

/* è§¸æ§æŒ‰å£“å›é¥‹ */
.omamori-arrow:active,
.omamori-finish:active {
  transform: scale(0.96);
}

/* ===== å¾¡å®ˆéƒ¨ä»¶åˆ‡æ›ï¼šå¾®å½ˆè·³æç¤ºï¼ˆä¸å½±éŸ¿å®šä½ï¼‰===== */

#omamoriPreview .omamori-part-wrap {
  position: absolute;
  inset: 0;              /* è®“ wrapper è¦†è“‹èˆå°ï¼Œä¸åƒèˆ‡æ’ç‰ˆ */
  pointer-events: none;  /* ä¸æ“‹æŒ‰éˆ• */
  z-index: 0;            /* çœŸæ­£å±¤ç´šç”± img è‡ªå·±çš„ z-index æ§åˆ¶ */
}

/* å¥—åœ¨ wrapper ä¸Šï¼Œé¿å…è·Ÿ img çš„å®šä½ transform æ‰“æ¶ */
#omamoriPreview .omamori-part-wrap.pop {
  animation: omamoriPartPop 220ms ease-out;
}

@keyframes omamoriPartPop {
  0%   { transform: translateY(0) scale(1); }
  40%  { transform: translateY(-8px) scale(1.03); }
  70%  { transform: translateY(0) scale(0.99); }
  100% { transform: translateY(0) scale(1); }
}


/* ====== Omamori æŒ‰éˆ•å‹•æ…‹ ====== */

/* 1) å·¦å³æŒ‰éˆ•ï¼šå¾®å¾®å¹³ç§»ï¼ˆå‹•ç•«å¥—åœ¨ imgï¼Œé¿å…è·Ÿ :active çš„ transform æ‰“æ¶ï¼‰ */
@keyframes arrowDriftLeft {
  0%, 100% { transform: translateX(0); }
  50%      { transform: translateX(-10px); } /* å¹…åº¦å¯èª¿ï¼š-6 ~ -14 */
}

@keyframes arrowDriftRight {
  0%, 100% { transform: translateX(0); }
  50%      { transform: translateX(10px); }  /* å¹…åº¦å¯èª¿ï¼š6 ~ 14 */
}

/* å·¦æŒ‰éˆ• imgï¼šå‘å·¦æ¼‚ */
.omamori-arrow.left img {
  animation: arrowDriftLeft 1.6s ease-in-out infinite;
}

/* å³æŒ‰éˆ• imgï¼šå‘å³æ¼‚ */
.omamori-arrow.right img {
  animation: arrowDriftRight 1.6s ease-in-out infinite;
}

/* 2) å®ŒæˆæŒ‰éˆ•ï¼šåŸåœ°å‘¼å¸ï¼ˆåŒæ¨£å¥—åœ¨ imgï¼‰ */
@keyframes finishBreathe {
  0%, 100% { transform: scale(1); }
  50%      { transform: scale(1.03); } /* å¹…åº¦å¯èª¿ï¼š1.02 ~ 1.06 */
}

.omamori-finish img {
  /* ä½ åŸæœ¬æ˜¯ 90% 90%ï¼Œä¿ç•™ï¼Œå†åŠ å‹•ç•« */
  animation: finishBreathe 1.8s ease-in-out infinite;
  transform-origin: center center;
}

/* =========================
   å³ä¸Šè§’ï¼šè¿”å› Menu æŒ‰éˆ•ï¼ˆå…±ç”¨ï¼‰
========================= */
.ui-btn-menu-topright {
  position: absolute;
  top: 14px;    /* ä½ æƒ³æ›´è²¼é‚Šå¯æ”¹ 24px */
  right: 20px;
  width: 140px; /* ä½ ä¹Ÿå¯ä»¥æ”¹ 120/160 */
  height: 138px;
  padding: 0;
  border: none;
  background: transparent;
  cursor: pointer;
   opacity: 80%;

  z-index: 4999; /* å£“éè§’è‰²/èƒŒæ™¯/å¾¡å®ˆï¼Œä¸å£“ modalï¼ˆmodal ä½ æ˜¯ 20000ï¼‰ */
}

.ui-btn-menu-topright img{
  width: 100%;
  height: 100%;
  display: block;
}

.ui-btn-menu-topright:active{
  transform: scale(0.96);
}

/* =========================
   âœ… Omamori Glow Layerï¼ˆæ•ˆèƒ½ç‰ˆï¼‰
   - å–ä»£ filter: drop-shadow å‹•ç•«
   - åªå‹• opacityï¼ˆæ‰‹æ©Ÿè¶…é †ï¼‰
========================= */

/* è®“ #omamoriPreview æˆç‚ºå®šä½å®¹å™¨ï¼ˆä½ æœ¬ä¾†å°±æœ‰ position:absolute; inset:0; é€™è£¡åªè£œä¿éšªï¼‰ */
#omamoriPreview{
  position: absolute;
  inset: 0;
}

/* Glow å±¤ï¼šè·Ÿå¾¡å®ˆåŒä¸€å¥—å®šä½ï¼ˆç”¨è·Ÿéƒ¨ä»¶ä¸€æ¨£çš„å¯¬èˆ‡ left/topï¼‰ */
#omamoriGlowLayer{
  position: absolute;

  /* âœ… å°é½Šå¾¡å®ˆæœ¬é«”çš„ä½ç½®ï¼ˆè·Ÿ .omamori-part ä¸€æ¨£ï¼‰ */
  left: 135px;
  top: 100px;
  width: 800px;
  height: 995px; /* 453 + 342 */

  pointer-events: none;

  /* æ”¾åœ¨æœ¬é«”ä¸‹é¢ï¼ˆæ¯” top/bottom/knot ä½ï¼‰ï¼Œé€™æ¨£åƒã€Œå¾è£¡é¢é€å‡ºä¾†ã€ */
  z-index: 0; /* ä½æ–¼ top/bottom(10) & knot(20)ï¼Œé«˜æ–¼èƒŒæ™¯ */

  opacity: 0;

  /* âœ… é€™å…©å€‹å¾ˆé‡è¦ï¼šé€¼ç€è¦½å™¨èµ°åˆæˆå±¤ï¼Œæ¸›å°‘å¡é “ */
  transform: translateZ(0);
  will-change: opacity;
}

/* âœ… èšç„¦æ™‚æ‰æ‰“é–‹ Glowï¼ˆåªåš opacity å‘¼å¸ï¼‰ */
#omamoriScreen.focus #omamoriGlowLayer{
  opacity: 1;
  animation: omamoriGlowBreath 2.4s ease-in-out infinite;
}

/* åªå‹• opacityï¼Œä¸å‹• filterï¼ˆæ•ˆèƒ½å¾ˆå¥½ï¼‰ */
@keyframes omamoriGlowBreath{
  0%, 100% { opacity: 0.72; }
  50%      { opacity: 1.00; }
}

#omamoriGlowLayer{
  background: url("images/omamori-glow.png") center/contain no-repeat;
}


/* âœ… å¾¡å®ˆ focusï¼ˆå®Œæˆèšç„¦ï¼‰æ™‚ï¼Œå³ä¸Šè§’é‚£é¡†å…ˆéš±è—ï¼Œé¿å…è·Ÿä½ ä¸‰é¡† focus actions é‡è¤‡ */
#omamoriScreen.focus #btnOmamoriMenu {
  display: none;
}





/* ====== Omamori å®Œæˆèšç„¦æ¨¡å¼ï¼ˆæš—å¹• + å¾¡å®ˆçªå‡ºï¼‰ ====== */

#omamoriScreen {
  position: absolute; /* ä¿éšªï¼šæ˜ç¢ºè®“å®ƒæ˜¯å®šä½å…ƒç´  */
  inset: 0;
  z-index: 1301;
}


/* âœ… å¤–å±¤ wrapperï¼šåªè² è²¬å®Œæˆç¬é–“å½ˆè·³ï¼ˆä¸å¹²æ¶‰å…§å±¤æ¼‚æµ®ï¼‰ */
#omamoriPreviewWrap {
  position: absolute;
  inset: 0;
  z-index: 20;
  transform-origin: center center;
}

/* âœ… focus æ™‚ï¼ŒæŠŠå¾¡å®ˆæ•´åŒ…æŠ¬åˆ°é»‘å¹•ä¸Šé¢ */
#omamoriScreen.focus #omamoriPreviewWrap {
  z-index: 60; /* > 40 (é»‘å¹•) */
}


/* å®Œæˆç¬é–“å½ˆè·³ä¸€æ¬¡ï¼ˆå¤–å±¤ï¼‰ */
@keyframes omamoriFinishPop {
  0%   { transform: translateY(0) scale(1.00); }
  35%  { transform: translateY(-10px) scale(1.05); }
  65%  { transform: translateY(2px)  scale(1.02); }
  100% { transform: translateY(0)    scale(1.00); }
}

/* è§¸ç™¼ class */
#omamoriScreen.focus .omamori-finish-pop {
  animation: omamoriFinishPop 380ms ease-out both;
}


/* å¾¡å®ˆé è¦½ wrapperï¼šå¹³å¸¸ä¸åšäº‹ï¼Œåªçµ¦å®Œæˆæ™‚ transform ç”¨ */
#omamoriPreview {
  position: absolute;
  inset: 0;
  z-index: 20;            /* å¹³å¸¸è·Ÿéƒ¨ä»¶å·®ä¸å¤šå±¤ */
  transform-origin: center center;
 transition: transform 280ms ease;
}

/* æš—å¹•ï¼šåªæš—ã€Œå¾¡å®ˆç•«é¢å…§çš„æ±è¥¿ã€ï¼Œä¸æœƒå½±éŸ¿æ•´å€‹ç¶²ç«™å…¶ä»– screen */
#omamoriScreen::before {
  content: "";
  position: absolute;
  inset: 0;
  background: rgba(0,0,0,0.80); /* ä½ æƒ³æ›´æš—å¯æ”¹ 0.55 */
  opacity: 0;
  transition: opacity 280ms ease;
  pointer-events: none;
  z-index: 40; /* ä»‹æ–¼èƒŒæ™¯èˆ‡å¾¡å®ˆä¹‹é–“/ä¹‹ä¸Šï¼Œç”¨ä¾†å£“æš—æŒ‰éˆ•èˆ‡èƒŒæ™¯ */
}

/* èšç„¦ç‹€æ…‹ classï¼šæˆ‘å€‘ç­‰ä¸€ä¸‹ç”¨ JS åŠ åœ¨ #omamoriScreen ä¸Š */
#omamoriScreen.focus::before {
  opacity: 1;
}

#omamoriScreen.focus #omamoriPreview {
  z-index: 60;

  /* âœ… åªç•™ä½ç§»/ç¸®æ”¾å‹•ç•«ï¼ˆGPU åˆæˆå±¤ï¼‰ï¼Œä¸è¦å†å‹•ç•« filter */
  animation: omamoriFloat 2.2s ease-in-out infinite;

  will-change: transform;
  transform: translateZ(0);
}



/* èšç„¦æ™‚ï¼šæŠŠå·¦å³éµèˆ‡å®Œæˆéµã€Œæ·¡å‡º + ä¸èƒ½é»ã€è®“è¦–è¦ºæ›´ä¹¾æ·¨ */
#omamoriScreen.focus .omamori-arrow,
#omamoriScreen.focus .omamori-finish {
  opacity: 0;          /* ä½ æƒ³å®Œå…¨æ¶ˆå¤±å°±æ”¹ 0 */
  pointer-events: none;
  transition: opacity 200ms ease;
}

/* å¯é¸ï¼šèšç„¦æ™‚æŠŠé£„è½æ«»èŠ±ç¨å¾®è®Šæ·¡ï¼ˆä¸æ˜¯å¿…é ˆï¼‰
   æ³¨æ„ï¼š#sakura åœ¨æ•´å€‹èˆå°ä¸Šå±¤ï¼Œè‹¥ä½ è¦ºå¾—å®ƒå¹²æ“¾ï¼Œå°±æ‰“é–‹é€™æ®µ
*/
/*
#omamoriScreen.focus ~ #sakura,
#omamoriScreen.focus #sakura {
  opacity: 0.35;
}
*/

/* ====== å®Œæˆå¾Œï¼šå¾¡å®ˆæ¼‚æµ® + ç™¼å…‰èµ·ä¼ ====== */

@keyframes omamoriFloat {
  0%, 100% { transform: translateY(0) scale(1.06); }
  50%      { transform: translateY(-14px) scale(1.06); } /* æ¼‚æµ®é«˜åº¦å¯èª¿ï¼š-8 ~ -18 */
}

@keyframes omamoriGlowPulse {
  0%, 100% {
    filter:
      drop-shadow(0 0 10px rgba(255, 230, 180, 0.45))
      drop-shadow(0 0 22px rgba(255, 215, 120, 0.35))
      drop-shadow(0 0 38px rgba(255, 255, 255, 0.15));
  }
  50% {
    filter:
      drop-shadow(0 0 14px rgba(255, 230, 180, 0.70))
      drop-shadow(0 0 30px rgba(255, 215, 120, 0.55))
      drop-shadow(0 0 55px rgba(255, 255, 255, 0.28));
  }
}

/* æ¡Œæ©Ÿï¼ˆæ»‘é¼ ç’°å¢ƒï¼‰æ‰åŠ ã€Œéœæ…‹ã€drop-shadow æå‡è³ªæ„Ÿï¼šæ³¨æ„æ˜¯éœæ…‹ï¼Œä¸å‹•ç•« */
@media (hover: hover) and (pointer: fine) {
  #omamoriScreen.focus #omamoriGlowLayer{
    filter: drop-shadow(0 0 18px rgba(255, 215, 120, 0.35));
  }
}


/* ====== Omamoriï¼šè§’è‰²èˆ‡å°è©±æ¡† ====== */

#omamoriDialogue {
  position: absolute;
  inset: 0;
  z-index: 35; /* èƒŒæ™¯(0) < å¾¡å®ˆ(10~20) < æŒ‰éˆ•(30)ï¼›é€™è£¡æ”¾åœ¨æŒ‰éˆ•ä¹‹ä¸Šæˆ–é™„è¿‘éƒ½å¯ */
  pointer-events: none; /* å…ˆä¸åƒé»æ“Šï¼›ä¹‹å¾Œè¦é»è§’è‰²å†æ‰“é–‹ */
}

/* å…±ç”¨ï¼šè§’è‰²å®¹å™¨ */
#omamoriDialogue .npc {
  position: absolute;
  bottom: 170px; /* é›¢åº•éƒ¨ä¸€é»é»ï¼Œé¿å…è²¼é‚Š */
  width: 410px;
  height: 432px;
}

/* å·¦å³ä½ç½®ï¼šå„ç•™ä¸€é»é‚Šè· */
#omamoriDialogue .npc.left  { left: 40px; }
#omamoriDialogue .npc.right { right: 40px; }

/* è§’è‰²åœ–æœ¬é«” */
#omamoriDialogue .npc-img {
  width: 410px;
  height: 432px;
  display: block;
}

/* å°è©±æ¡†å®¹å™¨ï¼šæ”¾åœ¨è§’è‰²ã€Œä¸‹æ–¹ä½†ç¨å¾®è“‹åˆ°è§’è‰²ã€ */
#omamoriDialogue .bubble {
  position: absolute;
  left: 50%;
  bottom: -110px;            /* å¾€ä¸‹å£“ä¸€é»ï¼›è² å€¼ä»£è¡¨æœƒè“‹åˆ°è§’è‰² */
  transform: translateX(-50%);
  width: 495px;
  height: 165px;
}

/* å°è©±æ¡†åœ–ç‰‡ */
#omamoriDialogue .bubble-img {
  width: 495px;
  height: 195px;
  display: block;
}

/* å°è©±æ–‡å­—ï¼šç–Šåœ¨æ°£æ³¡ä¸Š */
#omamoriDialogue .bubble-text {
  position: absolute;
  left: 50px;
  right: 40px;
  top: 36px;

  text-align: left;
  direction: ltr;
  unicode-bidi: plaintext;

  font-size: 22px;
  line-height: 1.3;
  color: rgb(155, 86, 98);
  font-family: 'Open Sans', sans-serif;

  word-break: break-word;

  user-select: none;
  pointer-events: none;
}

/* è§’è‰²å‘¼å¸ï¼šæ”¾åœ¨ wrapper ä¸Šï¼Œé¿å…è·Ÿå½ˆè·³æ¶ transform */
#omamoriDialogue .npc-breathe {
  display: inline-block;            /* è®“ transform ç”Ÿæ•ˆ */
  transform-origin: center bottom;  /* å¾è…³åº•å‘¼å¸æ¯”è¼ƒè‡ªç„¶ */
  animation: npcBreathe 3s ease-in-out infinite;
}

/* ä½ çš„å‘¼å¸ keyframesï¼ˆå¦‚æœä½ å·²æœ‰åŒåå°±æ²¿ç”¨ï¼‰ */
@keyframes npcBreathe {
  0%   { transform: scale(1); }
  50%  { transform: scale(1.015); }
  100% { transform: scale(1); }
}


/* ===== Omamori å°è©±æ¡†æ–‡å­—èª¿æ•´ ===== */



/* å½ˆè·³å‹•ç•«ï¼šæ”¾åœ¨ img ä¸Šï¼Œè·Ÿå‘¼å¸åˆ†é›¢ */
#omamoriDialogue .npc-img {
  display: block;
  transform-origin: center bottom;
}

/* å½ˆè·³ keyframesï¼ˆä½ åŸæœ¬é‚£å¥—å¯ç•™ï¼‰ */
@keyframes npcPop {
  0%   { transform: translateY(0) scale(1); }
  30%  { transform: translateY(-6px) scale(1.03); }
  60%  { transform: translateY(0) scale(0.99); }
  100% { transform: translateY(0) scale(1); }
}

/* è§¸ç™¼å½ˆè·³ class */
#omamoriDialogue .npc-img.npc-pop {
  animation: npcPop 260ms ease-out;
}

/* âœ… å®Œæˆèšç„¦å¾Œçš„ä¸‰é¡†æŒ‰éˆ•ï¼ˆé è¨­éš±è—ï¼‰ */
#omamoriFocusActions {
  position: absolute;
  left: 50%;
  transform: translateX(-50%);

  /* æ”¾åœ¨å¾¡å®ˆæ­£ä¸‹æ–¹ï¼š453 + 342 = 795
     ä½ ä¹‹å‰å®ŒæˆæŒ‰éˆ• top æ˜¯ +820+70ï¼Œé€™è£¡æˆ‘å€‘å…ˆç”¨ +820+55 ç•¶ä½œæŒ‰éˆ•åˆ—ä½ç½®ï¼ˆå¯å¾®èª¿ï¼‰ */
  top: calc(var(--omamori-y) + 820px + 270px);

  display: flex;
  gap: 120px;
  z-index: 9999;        /* ç¢ºä¿åœ¨æš—å¹•èˆ‡å¾¡å®ˆå…‰æšˆä¹‹ä¸Š */
  pointer-events: auto;
}

/* hidden å°±ä¸é¡¯ç¤º */
#omamoriFocusActions.hidden {
  display: none;
}

#omamoriFocusActions .focus-btn {
  width: 140px;
  height: 138px;
  padding: 0;
  border: none;
  background: transparent;
  cursor: pointer;
}

#omamoriFocusActions .focus-btn img {
  width: 100%;
  height: 100%;
  display: block;
}

#omamoriFocusActions .focus-btn:active {
  transform: scale(0.96);
}

/* âœ… èšç„¦æ™‚ï¼šä¸‰é¡†æŒ‰éˆ•å¾®å¾®ç™¼å…‰ï¼ˆä¸é–ƒçˆã€ç„¡å‹•ç•«ï¼‰ */
#omamoriScreen.focus #omamoriFocusActions .focus-btn img {
  /* é€™è£¡ç”¨å›ºå®š drop-shadowï¼Œé”åˆ°ã€ŒæŸ”å…‰ã€ä½†ä¸æœƒè·³å‹• */
  filter:
    drop-shadow(0 0 10px rgb(255, 255, 255, 0.5))
    drop-shadow(0 0 22px rgb(255, 237, 237, 0.5));
  
  /* è®“ç•«é¢æ›´ä¹¾æ·¨ï¼šç¨å¾®æäº®ä¸€é»é»ï¼ˆå¯é¸ï¼‰ */
  /* filter: ... brightness(1.02);  â† å¦‚æœä½ æƒ³è¦æ›´äº®å¯æ‰“é–‹ */
  
  transition: filter 160ms ease, transform 120ms ease;
}

/* âœ… è§¸æ§æŒ‰å£“ï¼šç¨å¾®æ›´äº® + å¾®ç¸®ï¼ˆä½ åŸæœ¬ focus-btn:active æœ‰ç¸®æ”¾ï¼Œé€™è£¡è£œå…‰ï¼‰ */
#omamoriScreen.focus #omamoriFocusActions .focus-btn:active img {
  filter:
    drop-shadow(0 0 12px rgba(255, 255, 255, 0.5))
    drop-shadow(0 0 28px rgb(255, 237, 237, 0.5));
}

/* ï¼ˆå¯é¸ï¼‰æ¡Œæ©Ÿ hoverï¼šä¹Ÿç¨å¾®æ›´äº®ä¸€é»é» */
@media (hover: hover) and (pointer: fine) {
  #omamoriScreen.focus #omamoriFocusActions .focus-btn:hover img {
    filter:
      drop-shadow(0 0 12px rgba(255, 255, 255, 0.5))
      drop-shadow(0 0 28px rgba(255, 237, 237, 0.5));
    transform: scale(1.02);
  }
}



/* âœ… Perfect åœ–ï¼ˆå®Œæˆèšç„¦æ‰å‡ºç¾ï¼‰ */
#omamoriPerfect {
  position: absolute;
  left: 0;
  width: 1080px;
  height: 189px;
  display: block;

  /* æ”¾åœ¨ä¸‰é¡†æŒ‰éˆ•æ­£ä¸Šæ–¹ï¼ˆä½ å·²ç¶“æŠŠæŒ‰éˆ•å¾€ä¸‹é¨°ç©ºé–“ï¼‰
     å¦‚æœä½ æƒ³æ›´è²¼è¿‘å¾¡å®ˆ/æŒ‰éˆ•ï¼Œåªè¦èª¿æœ€å¾Œçš„ 10px */
  top: calc(var(--omamori-y) + 820px + 200px - 189px - 5px);

  /* é è¨­éš±è— */
  opacity: 0;
  transform: translateY(10px) scale(0.98);
  pointer-events: none;

  /* å±¤ç´šï¼šè¦åœ¨æš—å¹•ä¹‹ä¸Šï¼Œä¹Ÿè¦åœ¨å¾¡å®ˆé™„è¿‘ï¼Œä½†ä¸ä¸€å®šè¦é«˜éæŒ‰éˆ• */
  z-index: 70;

  transition: opacity 260ms ease, transform 260ms ease, filter 260ms ease;
}

/* âœ… focus å…ˆä¸ç«‹åˆ»å‡ºç¾ï¼Œæ”¹ç”± perfect-show æ§åˆ¶ */
#omamoriScreen.focus #omamoriPerfect {
  opacity: 0;
  transform: translateY(10px) scale(0.98);
  animation: none;
}

/* âœ… Perfect å½ˆè·³ï¼ˆä¸€æ¬¡ï¼‰ */
@keyframes omamoriPerfectPop {
  0%   { transform: translateY(12px) scale(0.92); opacity: 0; }
  55%  { transform: translateY(-6px) scale(1.04); opacity: 1; }
  80%  { transform: translateY(2px) scale(0.99); }
  100% { transform: translateY(0) scale(1); }
}

#omamoriScreen.focus.perfect-show #omamoriPerfect {
  opacity: 1;

  /* âœ… åŒæ™‚åšï¼šå½ˆè·³ä¸€æ¬¡ + æŒçºŒç™¼å…‰ï¼ˆç”¨é€—è™Ÿåˆ†é–‹ï¼‰ */
  animation:
    omamoriPerfectPop 360ms ease-out both,
    omamoriPerfectGlow 2.4s ease-in-out infinite;

  will-change: filter, transform, opacity;
}



/* Perfect å°ˆç”¨ç™¼å…‰ï¼ˆä½ ä¹Ÿå¯ä»¥ç›´æ¥æ²¿ç”¨ omamoriGlowPulseï¼Œä½†åˆ†é–‹æ¯”è¼ƒå¥½èª¿ï¼‰ */
@keyframes omamoriPerfectGlow {
  0%, 100% {
    filter:
      drop-shadow(0 0 10px rgba(255, 230, 180, 0.35))
      drop-shadow(0 0 22px rgba(255, 215, 120, 0.25))
      drop-shadow(0 0 38px rgba(255, 255, 255, 0.5));
  }
  50% {
    filter:
      drop-shadow(0 0 14px rgba(255, 230, 180, 0.52))
      drop-shadow(0 0 30px rgba(255, 215, 120, 0.47))
      drop-shadow(0 0 55px rgba(255, 255, 255, 0.10));
  }
}


/* âœ… æˆªåœ–èˆå°ï¼šå¹³å¸¸æ”¾å¾ˆä¸‹é¢ã€ä¸åƒäº‹ä»¶ã€ä¸å½±éŸ¿ç•«é¢ */
#omamoriCaptureStage{
  position: fixed;
  left: 0;
  top: 0;
  width: 976px;
  height: 1814px;
  overflow: hidden;

  /* è®“å®ƒä¸æœƒè¢«çœ‹åˆ°ï¼šæ”¾åˆ°æœ€åº•å±¤ */
  z-index: -9999;
  pointer-events: none;

  /* ä¸è¦ç”¨ visibility:hiddenï¼ˆæœƒè®“ filter / html2canvas æ”¯æ´è®Šå·®ï¼‰ */
  opacity: 0; /* å¹³å¸¸ä¸å¯è¦‹ */
}



/* åº•åœ–é‹ªæ»¿ */
#omamoriCaptureBg {
  position: absolute;
  inset: 0;
  width: 976px;
  height: 1814px;
  display: block;
}

/* å¾¡å®ˆæˆå“å®¹å™¨ï¼šä¹‹å¾Œä½ è¦èª¿ä½ç½®/å¤§å°å°±æ”¹é€™è£¡ */
#omamoriCaptureOmamori {
  position: absolute;

  /* âœ… å…ˆçµ¦ä½ ä¸€å€‹ã€Œä¸­ä¸Šæ–¹ã€çš„é è¨­å€¼ï¼ˆä¹‹å¾Œå†å¾®èª¿ï¼‰ */
  left: 50%;
  top: 200px;
  transform: translateX(-50%);

  /* ä½ å…ˆç”¨é€™å€‹å¯¬åº¦ï¼Œä¹‹å¾Œå†èª¿ */
  width: 600px;
  height: 795px; /* top453 + bottom342 = 795 */
}

/* ä¸‰å¼µç–Šåˆï¼ˆè·Ÿä½ ä¸»ç•«é¢ä¸€è‡´ï¼‰ */
#omamoriCaptureOmamori img {
  position: absolute;
  left: 0;
  width: 100%;
  display: block;
}

#capTop    { top: 0; height: 453px; z-index: 10; }
#capBottom { top: 453px; height: 342px; z-index: 10; }
#capKnot   { top: 10px; height: 197px; z-index: 20; }
#resultModal { z-index: 20000; }

/* âœ… æˆªåœ–ç”¨å¾¡å®ˆç™¼å…‰ï¼ˆå¥—åœ¨æ¯å¼µåœ–ä¸Šï¼Œæ¯”å¥—å®¹å™¨æ›´ç©©ï¼‰ */
#omamoriCaptureOmamori.cap-glow img{
  filter:
    drop-shadow(0 0 10px rgba(255, 230, 180, 0.70))
    drop-shadow(0 0 26px rgba(255, 215, 120, 0.55))
    drop-shadow(0 0 52px rgba(255, 255, 255, 0.22));
}








/* ğŸ´ ç±¤ç´™ï¼ˆè«‹å¡«ä½ å¯¦éš›è¨­è¨ˆå°ºå¯¸ï¼‰ */
.omikuji {
    position: absolute;
    left: 540px;   /* è¨­è¨ˆç¨¿ä¸­å¿ƒX */
    top: 960px;    /* è¨­è¨ˆç¨¿ä¸­å¿ƒY */
    transform: translate(-50%, -50%);
    width: 1150px;  /* â† æ”¹æˆä½ å¯¦éš›å¯¬åº¦ */
    z-index: 2;
    transition: transform 0.3s ease, filter 0.3s ease;
}

/* âœ… èƒŒæ™¯åœ–ï¼šä¸€å®šè¦é‹ªæ»¿èˆå°ï¼Œä¸¦ä¸”åœ¨æœ€åº•å±¤ */
.bg {
  position: absolute;
  inset: 0;              /* ç­‰åŒ top:0 right:0 bottom:0 left:0 */
  width: 100%;
  height: 100%;
  object-fit: cover;     /* ä½ æƒ³å®Œæ•´é¡¯ç¤ºå¯ä»¥æ”¹ containï¼Œä½†é€šå¸¸èƒŒæ™¯ç”¨ cover */
  z-index: 0;
  pointer-events: none;
  display: block;        /* é¿å… img çš„ inline è¡Œç‚ºé€ æˆæ€ªé–“éš™ */
}


/* ğŸ‘¥ è§’è‰²å¾®å‘¼å¸å‹•ç•« */
.characters {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 1080px;
    z-index: 3;
    pointer-events: none;

    animation: breathe 4s ease-in-out infinite;
    transform-origin: center bottom; /* å¾è…³åº•ç‚ºåŸºæº–å‘¼å¸ */
}
@keyframes breathe {
    0%   { transform: scale(1); }
    50%  { transform: scale(1.015); } /* åªæ”¾å¤§ 1.5% */
    100% { transform: scale(1); }
}


/* ğŸ”˜ æŠ½ç±¤æŒ‰éˆ•ï¼ˆè«‹å¡«ä½ çš„è¨­è¨ˆä½ç½®ï¼‰ */
.draw-btn {
    position: absolute;
    left: 540px;
    top: 1760px;
    transform: translate(-50%, -50%);

    width: 680px;
    height: 300px;

    background: url("images/draw-btn.png") no-repeat center/contain;
    background-color: transparent;

    border: none;
    padding: 0;
    cursor: pointer;
    z-index: 4;

    animation: pulse 1.6s ease-in-out infinite;

    transition:
        filter 0.3s ease,
        transform 0.15s ease;
}


.draw-btn:active {
    transform: translate(-50%, -50%) scale(0.95);
    filter: brightness(0.9);
}

/* æŠ½ä¸­å¾Œç‰¹æ•ˆ */
.omikuji.glow {
    transform: translate(-50%, -50%) scale(1.08);
    filter: drop-shadow(0 0 25px gold);
}
/* ğŸ”„ æŒ‰éˆ•å‘¼å¸å‹•ç•« */
@keyframes pulse {
    0% {
        transform: translate(-50%, -50%) scale(1);
    }
    50% {
        transform: translate(-50%, -50%) scale(1.05);
    }
    100% {
        transform: translate(-50%, -50%) scale(1);
    }
}

#resultModal {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.75);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 20000;
}

.modalContent {
  width: 860px;
  background: white;
  border-radius: 30px;
  padding: 40px 30px 50px;
  text-align: center;
  position: relative;
  animation: modalPop 0.4s ease;
}

@keyframes modalPop {
  from { transform: scale(0.8); opacity: 0; }
  to   { transform: scale(1); opacity: 1; }
}

#resultImage {
  width: 100%;
  border-radius: 20px;
  margin-bottom: 30px;
}

.modalButtons {
  display: flex;
  justify-content: center;
  gap: 30px;
}

.modalButtons img {
  width: 420px;
  cursor: pointer;
  transition: transform 0.15s ease;
}

.modalButtons img:active {
  transform: scale(0.92);
}

#closeModal {
  position: absolute;
  top: 20px;
  right: 20px;
  width: 120px;
}

/* å¤œæ™šåœ–é è¨­éš±è— */
/* âœ… ç™½å¤©åœ–é è¨­é¡¯ç¤º */
#omikujiScreen .day { opacity: 1; transition: opacity 1.5s ease-in-out; }
body.night-mode #omikujiScreen .day { opacity: 0; pointer-events:none; }

#omikujiScreen .night { opacity: 0; transition: opacity 1.5s ease-in-out; pointer-events:none; }
body.night-mode #omikujiScreen .night { opacity: 1; }


.menu-background.night { display: none; background-image: url("images/menu-bg-night.jpg"); }

body.night-mode .menu-background.day { display: none; }
body.night-mode .menu-background.night { display: block; }

